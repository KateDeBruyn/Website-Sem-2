<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://d3js.org/d3.v4.js"></script>
    <title>Document</title>
  </head>
  <body>
    <div>
      <button onclick="update(data1)">Steam Rating</button>
      <button onclick="update(data2)">Savings</button>
      <div id="interactive_G3">
        <script>
          // create 2 data_set
          // var data1 = [
          //     { group: "A", value: 4 },
          //     { group: "B", value: 16 },
          //     { group: "C", value: 8 },
          // ];

          // var data2 = [
          //     { group: "A", value: 7 },
          //     { group: "B", value: 1 },
          //     { group: "C", value: 20 },
          // ];

          async function getDataG1() {
            const api_url =
              "https://www.cheapshark.com/api/1.0/deals?storeID=1&upperPrice=15";
            // Raw data
            const api_data = await fetch(api_url);

            // Converts raw data to json
            const api_json = await api_data.json();

            // const dataG1 = api_json.slice(0, 4);

            // Created a list of IDs for games that will be displayed
            const gameIds = ["166", "160047", "247672", "168082"];

            // dataG1 is the filtered list
            const dataG1 = api_json.filter(function (game) {
              // Returns a list of games that match our list of IDs
              if (gameIds.includes(game.gameID)) {
                return game;
              }
            });

            // set the dimensions and margins of the graph
            var marginG3 = { top: 30, right: 30, bottom: 70, left: 60 },
              widthG3 = 460 - marginG3.left - marginG3.right,
              heightG3 = 400 - marginG3.top - marginG3.bottom;

            // append the svg object to the body of the page
            var svg = d3
              .select("#interactive_G3")
              .append("svg")
              .attr("width", widthG3 + marginG3.left + marginG3.right)
              .attr("height", heightG3 + marginG3.top + marginG3.bottom)
              .append("g")
              .attr(
                "transform",
                "translate(" + marginG3.left + "," + marginG3.top + ")"
              );

            // X axis
            var x = d3
              .scaleBand()
              .range([0, widthG3])
              .domain(
                dataG1.map(function (d) {
                  return d.title;
                })
              )
              .padding(0.2);
            svg
              .append("g")
              .attr("transform", "translate(0," + heightG3 + ")")
              .call(d3.axisBottom(x));

            // Add Y axis
            var y = d3.scaleLinear().domain([0, 100]).range([heightG3, 0]);
            svg.append("g").attr("class", "myYaxis").call(d3.axisLeft(y));

            // A function that create / update the plot for a given variable:
            function update(data) {
              var u = svg.selectAll("rect").data(dataG1);

              u.enter()
                .append("rect")
                .merge(u)
                .transition()
                .duration(1000)
                .attr("x", function (d) {
                  return x(d.title);
                })
                .attr("y", function (d) {
                  return y(d.steamRatingPercent);
                })
                .attr("width", x.bandwidth())
                .attr("height", function (d) {
                  return heightG3 - y(d.savings);
                })
                .attr("fill", "#69b3a2");
            }

            // Initialize the plot with the first dataset
            update(data1);
          }
        </script>
      </div>
    </div>
  </body>
</html>
